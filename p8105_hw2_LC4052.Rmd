---
title: "p8105_hw2_LC4052"
Author: "Linqi Chu"
output: github_document
date: "2025-09-28"
---

```{r}
library(tidyverse)
library(dplyr)
library(readxl)

```


# Problem 1

## Clean the data in pols-month.csv

```{r}
pols_month = 
  read_csv("./fivethirtyeight_datasets/pols-month.csv",
           na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  separate(mon, c("year", "month","day")) |>
  mutate(
    month = month.name[as.integer(month)],
    president = ifelse(prez_gop == 1, "gop", "dem")
  )|>
  select(-prez_dem, -prez_gop, -day)

```


## Clean the data in snp.csv

```{r}
snp_df = 
  read_csv("./fivethirtyeight_datasets/snp.csv",
           na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  separate(date, c("month", "day","year")) |>
  mutate(
    month = month.name[as.integer(month)],
    year = as.integer(year),
    year = ifelse(year < 50,
                 2000 + year,
                 1900 + year),
    year = as.character(year)) |>
  select(-day) |>
  relocate(year, month, .before = everything()) |> 
  arrange(year, month)


```


## Tidy the unemployment data

```{r}
unemployment_df = 
  read_csv("./fivethirtyeight_datasets/unemployment.csv",
           na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  pivot_longer(
    jan:dec,
    names_to = "month", 
    values_to = "unemployment(%)") |>
  mutate(
    month = factor(month, 
                      levels = c("jan","feb","mar","apr","may","jun",
                                 "jul","aug","sep","oct","nov","dec"),
                      labels = month.name),
    year = as.character(year))

```


## Join the datasets by merging snp into pols, and merging unemployment into the result

```{r}
pols_df = 
  left_join(pols_month, snp_df, by = c("year","month")) |>
  left_join(unemployment_df, by = c("year","month"))

```


## Description of datasets

```{r}
names(pols_month)
names(snp_df)
names(unemployment_df)
names(pols_df)

```

Pols-month contains variables:"year", "month", "gov_gop", "sen_gop", "rep_gop", "gov_dem", "sen_dem", "rep_dem" and "president".
Snp_df contains variables: "year", "month" and "close".
Unemployment_df contains variables: "year", "month" and "unemployment(%)".

The resulting dataset spans from 1947 to 2015 and contains 822 observations, each with 11 features.
It contains variables: "year", "month", "gov_gop", "sen_gop", "rep_gop", "gov_dem", "sen_dem", "rep_dem", "president", "close" and "unemployment(%)".




# Problem 2

## Clean the Mr. Trash Wheel sheet

```{r}
mrtrash_df = 
  read_excel("./trash_collection_data/202509 Trash Wheel Collection Data.xlsx",
             sheet = "Mr. Trash Wheel",
             skip = 1,
             na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  select(-c(15, 16)) |>
  filter(!is.na(dumpster) & !is.na(weight_tons)) |>
  mutate(sports_balls = as.integer(round(sports_balls))) |>
  mutate(trash_wheel = "Mr. Trash Wheel") |>
  mutate(year = as.integer(year))


```


## Clean the Professor Trash Wheel dataset

```{r}
protrash_df = 
  read_excel("./trash_collection_data/202509 Trash Wheel Collection Data.xlsx",
             sheet = "Professor Trash Wheel",
             skip = 1,
             na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster) & !is.na(weight_tons)) |>
  mutate(trash_wheel = "Professor Trash Wheel") |>
  mutate(year = as.integer(year))
  
  
```


## Clean the Gwynnda Trash Wheel dataset

```{r}
gwytrash_df = 
  read_excel("./trash_collection_data/202509 Trash Wheel Collection Data.xlsx",
             sheet = "Gwynns Falls Trash Wheel",
             skip = 1,
             na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster) & !is.na(weight_tons)) |>
  mutate(trash_wheel = "Gwynnda Trash Wheel") |>
  mutate(year = as.integer(year))


```


# Combine the three datasets

```{r}
trash_data <- bind_rows(mrtrash_df, protrash_df, gwytrash_df)

```


The resulting data has `r nrow(trash_data)` observations, each with `r ncol(trash_data)` variables. The key variables are: `r names(trash_data)`.

The total weight of trash collected by Professor Trash Wheel is `r sum(trash_data[trash_data$trash_wheel == "Professor Trash Wheel", "weight_tons"])`. 
The total number of cigarette butts collected by Gwynnda in June of 2022 is 
`r sum(trash_data[trash_data$trash_wheel == "Gwynnda Trash Wheel", "cigarette_butts"])`.




# Problem 3

## Create a single, well-organized dataset

### Clean the zip_codes file

```{r}
zipcodes_df = 
  read_csv("./zillow_data/Zip Codes.csv",
             na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  mutate(
    file_date = as.character(lubridate::mdy(file_date))
  ) |>
  select(county,zip_code,file_date, everything())

names(zipcodes_df)

```


### Clean the zip_zori file

```{r}
zori_df = 
  read_csv("./zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv",
             na = c("NA", ".", "")) |>
  pivot_longer(
    cols = 10 : 125,
    names_to = "file_date", 
    values_to = "rent_price") |>
    mutate(file_date = as.character(file_date)) |>
  rename(county = CountyName, zip_code = RegionName) |>                       
  mutate(county = sub(" County$", "", county)) |> 
  arrange(zip_code) |>
  select(county,zip_code,file_date, rent_price, everything())


names(zori_df)

```


### Combine the two datasets

```{r}
combined_data = 
  full_join(zipcodes_df, zori_df, by = c("county","zip_code","file_date")) |>
  select(county,zip_code,file_date, rent_price, neighborhood, everything())

```



## Descriptions

The resulting dataset contains information from two zillow datasets (`zipcodes_df` and `zori_df`) with `r nrow(combined_data)` observations and `r ncol(combined_data)` variables. Each observation has its identical variables (`county`, `zip_code`, `file_date`), and some other variables such as `rent_price` and `neighborhood`.


### unique zip codes

```{r}
combined_data |> 
  distinct(zip_code) |> 
  nrow()

```
There are 320 unique ZIP codes.

### unique neighborhoods

```{r}
combined_data |> 
  distinct(neighborhood) |> 
  nrow()

```
There are 43 unique neighborhoods.

### unique zip codes in `zip_codes`

```{r}
missing_part = 
  zipcodes_df |> 
  anti_join(zori_df, by = "zip_code") |> 
  distinct(zip_code)

print(missing_part)

```

The above are the ZIP codes appear in the ZIP code dataset but not in the Zillow Rental Price dataset.


### Using a few illustrative examples discuss why these ZIP codes might be excluded from the Zillow dataset.

Possible reasons include:
(1) These ZIP codes are primarily commercial,institutional or parks rather than residential. 
(2) The number of rental units is too small for Zillow to reliably estimate rent prices.
(3) The ZIP code is new or unique-purpose (assigned to an organization or facility).


### Table
Rental prices fluctuated dramatically during the COVID-19 pandemic. For all available ZIP codes, compare rental prices in January 2021 to prices in January 2020. Make a table that shows the 10 ZIP codes (along with the borough and neighborhood) with largest drop in price from January 2020 to 2021. Comment.

```{r}










```

